// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i;e=jQuery;r={"class":"snipe-lens",size:200,animation:null,image:null,cursor:"none",bounds:[],css:{borderRadius:200,width:200,height:200,border:"2px solid white",backgroundColor:"white",boxShadow:"0 0 10px #777, 0 0 8px black inset, 0 0 80px white inset"},zoomin:function(e){},zoomout:function(e){},zoommoved:function(e){}};i={position:"absolute",top:0,left:0,backgroundRepeat:"no-repeat"};t=function(){function e(e,t,n,r){this.top=e;this.right=t;this.bottom=n;this.left=r;return this}e.prototype.contains=function(e,t){return this.left<e&&e<this.right&&this.top<t&&t<this.bottom};return e}();n=function(){function n(t,n){var i=this;this.el=t;n==null&&(n={});this.body=e("body");this.defaults=e.extend({},r);this.settings=this.makeSettings(n);this.el.one("load",function(){i.offset=i.el.offset();return i.bounds=i.makeBounds()}).each(function(){if(this.complete)return e(this).load()});this.lens=e("<div>").addClass(this.settings["class"]).css("display","none").appendTo("body");this.ratioX=1;this.ratioY=1;this.ratioEl=e("<img>").load(function(){return i.calculateRatio(i)}).attr("src",this.settings.image).css("display","none").appendTo(this.el.parent());this.el.bind("mousemove",function(e){return i.onMouseMove(e)});return this.el}n.prototype.makeSettings=function(t){var n;if(this.el.is("a")){n=this.el.find("img:first");this.defaults.image=t.image||this.el.attr("href")}else{n=this.el.is("img")?this.el:this.el.find("img:first");this.defaults.image=t.image||this.el.data("zoom")||this.el.attr("src")}this.el=n;this.defaults.css.backgroundImage="url("+this.defaults.image+")";this.defaults.css.cursor=t.cursor||this.defaults.cursor;this.defaults.css=e.extend({},this.defaults.css,t&&t.css,i);return e.extend({},this.defaults,t)};n.prototype.makeBounds=function(){return new t(this.offset.top,this.offset.left+this.el.width(),this.offset.top+this.el.height(),this.offset.left)};n.prototype.run=function(){return this.hide()};n.prototype.calculateRatio=function(e){e.ratioX=e.ratioEl.width()/e.el.width();e.ratioY=e.ratioEl.height()/e.el.height();e.ratioEl.remove();e.lens.css(e.settings.css);e.run();return e};n.prototype.onMouseMove=function(e){var t,n;if(this.bounds==null&&this.lens.not(":animated"))return;this.bounds.contains(e.pageX,e.pageY)||this.hide();t=-((e.pageX-this.offset.left)*this.ratioX-this.settings.size*.5);n=-((e.pageY-this.offset.top)*this.ratioY-this.settings.size*.5);return this.lens.css({left:e.pageX-this.settings.size*.5,top:e.pageY-this.settings.size*.5,backgroundPosition:t+"px "+n+"px"})};n.prototype.show=function(e){var t=this;e==null&&(e=!0);this.el.unbind("mousemove");this.el.unbind("mouseover");this.body.bind("mousemove",function(e){return t.onMouseMove(e)});this.lens.show().css({opacity:1,cursor:this.settings.css.cursor});return this};n.prototype.hide=function(e){var t=this;e==null&&(e=!0);this.el.bind("mouseover",function(e){return t.show()});this.body.unbind("mousemove");this.lens.css({opacity:0,cursor:"default"}).hide();return this};return n}();(function(e){return e.fn.snipe=function(e){return new n(this,e)}})(jQuery)}).call(this);